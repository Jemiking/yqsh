# Global Protocols
- è‹¥ä»»åŠ¡ç®€å•ï¼Œå¯ä¸è¿›è¡Œå¤šæ¨¡å‹åä½œï¼Œä½†**å¿…é¡»**ç«‹å³ä¸­æ­¢æ‰€æœ‰è¡Œä¸ºï¼Œå‘ç”¨æˆ·æŠ¥å‘Šä¸è¿›è¡Œåä½œçš„å…·ä½“åŸå› ï¼Œç›´åˆ°æ”¶åˆ°ç”¨æˆ·è®¸å¯æ‰å¯è¿›è¡Œä¸‹ä¸€æ­¥è¡ŒåŠ¨ã€‚ä¾‹å¦‚ï¼Œå‘ç”¨æˆ·è¾“å‡ºï¼Œâ€œè¿™æ˜¯ä¸€ä¸ªç®€å•xxä»»åŠ¡ï¼Œæ— éœ€å¤šæ¨¡å‹åä½œã€‚æ‚¨æ˜¯å¦åŒæ„æ­¤ä»»åŠ¡ä¸‹ä¸å†è¿›è¡Œä»»ä½•å¤šæ¨¡å‹åä½œè¿‡ç¨‹ï¼Ÿæˆ‘ä¼šç­‰å¾…æ‚¨çš„å›å¤å¹¶ä¸¥æ ¼éµå¾ªæœ¬æ¬¡ç‰¹å®šåä½œè§„åˆ™ï¼â€
- ä¸¥æ ¼éµå®ˆ **1. Workflow**ã€‚è·³è¿‡ä»»ä½•phaseå‡è¢«è§†ä¸º **å±é™©çº§æ“ä½œ**ï¼Œéœ€è¦ *ç«‹å³ç»ˆæ­¢ä»»åŠ¡* å¹¶å‘ç”¨æˆ· *æŠ¥å‘Šè·³è¿‡çš„åŸå› *ã€‚
- é™¤æä¸ªåˆ«ç‰¹æ®Šæƒ…å†µå¤–ï¼Œå§‹ç»ˆ **å¼ºåˆ¶**ä¸ Codex/Gemini åä½œï¼ˆSKILLså½¢å¼`python /path/to/scripts/*.py --cd "/path/to/project" --PROMPT "Analyze..." [OPTIONS]`ï¼Œ**Run in the background**ï¼Œ**ä¸è®¾ç½®** timeoutï¼‰ã€‚

----
## 0. Core Instruction

### 0.1 äº¤äº’ä¸çŠ¶æ€ç®¡ç†
- **è¯­è¨€åè®®**ã€‚ä¸å·¥å…·/æ¨¡å‹äº¤äº’ï¼š**è‹±è¯­**ï¼›ä¸ç”¨æˆ·äº¤äº’ï¼š**ä¸­æ–‡**ã€‚
- **ä¼šè¯è¿ç»­æ€§**ã€‚å¦‚æœå·¥å…·è¿”å› `SESSION_ID`ï¼Œç«‹å³å­˜å‚¨ï¼›åœ¨è°ƒç”¨å·¥å…·ä¹‹å‰ï¼Œ**æ€è€ƒ**ï¼šâ€œè¿™æ˜¯ä¸€ä¸ªåç»­æ“ä½œå—ï¼Ÿâ€å¦‚æœæ˜¯ï¼Œåœ¨å‘½ä»¤åè¿½åŠ  `--SESSION_ID <ID>`ï¼›å¦‚æœå†…æ ¸è¾“å‡ºè¢«æˆªæ–­ï¼Œè‡ªåŠ¨æ‰§è¡Œç»§ç»­å‘½ä»¤æˆ–å¾ªç¯ï¼Œç›´åˆ° `Unified Diff`ï¼ˆç»Ÿä¸€å·®å¼‚ï¼‰åœ¨è¯­æ³•ä¸Šå®Œæ•´ã€‚

### 0.2 å¼‚æ­¥æ“ä½œï¼ˆåŸå­å¾ªç¯ï¼‰
- **å¼ºåˆ¶å¹¶è¡Œ**ã€‚å¯¹äºä»»ä½•æ¶‰åŠ Codex/Gemini æˆ–é•¿æ—¶é—´è¿è¡Œè„šæœ¬çš„ä»»åŠ¡ï¼Œå¿…é¡»ä½¿ç”¨ **Run in the background**ï¼ˆ**ä¸è®¾ç½®** timeoutï¼‰ã€‚
- **CLI ç»“æ„**ã€‚ç¡®ä¿ CLI è°ƒç”¨éµå¾ªSKILLså®šä¹‰ï¼Œé€šå¸¸ä¸ºï¼š`python /path/to/scripts/*.py --cd "/path/to/project" --PROMPT "Analyze..." [OPTIONS]`

### 0.3 å®‰å…¨ä¸ä»£ç ä¸»æƒ
- **æ— å†™å…¥æƒ**ã€‚Codex/Gemini å¯¹æ–‡ä»¶ç³»ç»Ÿæ‹¥æœ‰ **é›¶** å†™å…¥æƒé™ï¼›åœ¨æ¯ä¸ªå†…æ ¸ PROMPTï¼ˆæç¤ºè¯ï¼‰ä¸­ï¼Œæ˜¾å¼è¿½åŠ ï¼š**"OUTPUT: Unified Diff Patch ONLY. Strictly prohibit any actual modifications."**
- **å‚è€ƒé‡æ„**ã€‚å°†è·å–åˆ°çš„å…¶ä»–æ¨¡å‹çš„Uniffied Patchè§†ä¸ºâ€œè„åŸå‹ï¼ˆDirty Prototypeï¼‰â€ï¼›**æµç¨‹**ï¼šè¯»å– Diff -> **æ€ç»´æ²™ç®±**ï¼ˆæ¨¡æ‹Ÿåº”ç”¨å¹¶æ£€æŸ¥é€»è¾‘ï¼‰ -> **é‡æ„**ï¼ˆæ¸…ç†ï¼‰ -> æœ€ç»ˆä»£ç ã€‚

### 0.4 ä»£ç é£æ ¼
- æ•´ä½“ä»£ç é£æ ¼**å§‹ç»ˆå®šä½**ä¸ºï¼Œç²¾ç®€é«˜æ•ˆã€æ¯«æ— å†—ä½™ã€‚è¯¥è¦æ±‚åŒæ ·é€‚ç”¨äºæ³¨é‡Šä¸æ–‡æ¡£ï¼Œä¸”å¯¹äºè¿™ä¸¤è€…ï¼Œä¸¥æ ¼éµå¾ª**éå¿…è¦ä¸å½¢æˆ**çš„æ ¸å¿ƒåŸåˆ™ã€‚
- **ä»…å¯¹éœ€æ±‚åšé’ˆå¯¹æ€§æ”¹åŠ¨**ï¼Œä¸¥ç¦å½±å“ç”¨æˆ·ç°æœ‰çš„å…¶ä»–åŠŸèƒ½ã€‚

### 0.5 å·¥ä½œæµç¨‹å®Œæ•´æ€§
- **æ­¢æŸ**ï¼šåœ¨å½“å‰é˜¶æ®µçš„è¾“å‡ºé€šè¿‡éªŒè¯ä¹‹å‰ï¼Œä¸è¦è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚
- **æŠ¥å‘Š**ï¼šå¿…é¡»å‘ç”¨æˆ·å®æ—¶æŠ¥å‘Šå½“å‰é˜¶æ®µå’Œä¸‹ä¸€é˜¶æ®µã€‚

----
## 1. Workflow

### Phase 1: ä¸Šä¸‹æ–‡å…¨é‡æ£€ç´¢ (Relace Interface)
**æ‰§è¡Œæ¡ä»¶**ï¼šåœ¨ç”Ÿæˆä»»ä½•å»ºè®®æˆ–ä»£ç å‰ã€‚
1.  **å·¥å…·è°ƒç”¨**ï¼šè°ƒç”¨ `mcp__Relace__relace_search`ã€‚
2.  **æ£€ç´¢ç­–ç•¥**ï¼š
    - ç¦æ­¢åŸºäºå‡è®¾ï¼ˆAssumptionï¼‰å›ç­”ã€‚
    - ä½¿ç”¨è‡ªç„¶è¯­è¨€ï¼ˆNLï¼‰æ„å»ºè¯­ä¹‰æŸ¥è¯¢ï¼ˆWhere/What/Howï¼‰ã€‚
    - **å®Œæ•´æ€§æ£€æŸ¥**ï¼šå¿…é¡»è·å–ç›¸å…³ç±»ã€å‡½æ•°ã€å˜é‡çš„å®Œæ•´å®šä¹‰ä¸ç­¾åã€‚è‹¥ä¸Šä¸‹æ–‡ä¸è¶³ï¼Œè§¦å‘é€’å½’æ£€ç´¢ã€‚
3.  **éœ€æ±‚å¯¹é½**ï¼šè‹¥æ£€ç´¢åéœ€æ±‚ä»æœ‰æ¨¡ç³Šç©ºé—´ï¼Œ**å¿…é¡»**å‘ç”¨æˆ·è¾“å‡ºå¼•å¯¼æ€§é—®é¢˜åˆ—è¡¨ï¼Œç›´è‡³éœ€æ±‚è¾¹ç•Œæ¸…æ™°ï¼ˆæ— é—æ¼ã€æ— å†—ä½™ï¼‰ã€‚


### Phase 2: å¤šæ¨¡å‹åä½œåˆ†æ 
1.  **åˆ†å‘è¾“å…¥**ï¼šï¼šå°†ç”¨æˆ·çš„**åŸå§‹éœ€æ±‚**ï¼ˆä¸å¸¦é¢„è®¾è§‚ç‚¹ï¼‰åˆ†å‘ç»™ Codex å’Œ Geminiã€‚æ³¨æ„ï¼ŒCodex/Geminiéƒ½æœ‰å®Œå–„çš„CLIç³»ç»Ÿï¼Œæ‰€ä»¥**ä»…éœ€ç»™å‡ºå…¥å£æ–‡ä»¶å’Œrow index**(è€ŒéSnippet)ã€‚
2.  **æ–¹æ¡ˆè¿­ä»£**ï¼š
    - è¦æ±‚æ¨¡å‹æä¾›å¤šè§’åº¦è§£å†³æ–¹æ¡ˆã€‚
    - è§¦å‘**äº¤å‰éªŒè¯**ï¼šæ•´åˆå„æ–¹æ€è·¯ï¼Œè¿›è¡Œè¿­ä»£ä¼˜åŒ–ï¼Œåœ¨è¿‡ç¨‹ä¸­æ‰§è¡Œé€»è¾‘æ¨æ¼”å’Œä¼˜åŠ£åŠ¿äº’è¡¥ï¼Œç›´è‡³ç”Ÿæˆæ— é€»è¾‘æ¼æ´çš„ Step-by-step å®æ–½è®¡åˆ’ã€‚
3.  **å¼ºåˆ¶é˜»æ–­ (Hard Stop)**ï¼šå‘ç”¨æˆ·å±•ç¤ºæœ€ç»ˆå®æ–½è®¡åˆ’ï¼ˆå«é€‚åº¦ä¼ªä»£ç ï¼‰ï¼›å¿…é¡»ä»¥åŠ ç²—æ–‡æœ¬è¾“å‡ºè¯¢é—®ï¼š"Shall I proceed with this plan? (Y/N)"ï¼›ç«‹å³ç»ˆæ­¢å½“å‰å›å¤ã€‚ç»å¯¹ç¦æ­¢åœ¨æ”¶åˆ°ç”¨æˆ·æ˜ç¡®çš„ "Y" ä¹‹å‰æ‰§è¡Œ Phase 3 æˆ–è°ƒç”¨ä»»ä½•æ–‡ä»¶è¯»å–å·¥å…·ã€‚

### Phase 3: åŸå‹è·å–
- **Route A: å‰ç«¯/UI/æ ·å¼ (Gemini Kernel)**
  - **é™åˆ¶**ï¼šä¸Šä¸‹æ–‡ < 32kã€‚geminiå¯¹äºåç«¯é€»è¾‘çš„ç†è§£æœ‰ç¼ºé™·ï¼Œå…¶å›å¤éœ€è¦å®¢è§‚å®¡è§†ã€‚
  - **æŒ‡ä»¤**ï¼šè¯·æ±‚ CSS/React/Vue åŸå‹ã€‚ä»¥æ­¤ä¸ºæœ€ç»ˆå‰ç«¯è®¾è®¡åŸå‹ä¸è§†è§‰åŸºå‡†ã€‚
- **Route B: åç«¯/é€»è¾‘/ç®—æ³• (Codex Kernel)**
  - **èƒ½åŠ›**ï¼šåˆ©ç”¨å…¶é€»è¾‘è¿ç®—ä¸ Debug èƒ½åŠ›ã€‚
  - **æŒ‡ä»¤**ï¼šè¯·æ±‚é€»è¾‘å®ç°åŸå‹ã€‚
- **é€šç”¨çº¦æŸ**ï¼šï¼šåœ¨ä¸Codex/Geminiæ²Ÿé€šçš„ä»»ä½•æƒ…å†µä¸‹ï¼Œ**å¿…é¡»**åœ¨ Prompt ä¸­**æ˜ç¡®è¦æ±‚** è¿”å› `Unified Diff Patch`ï¼Œä¸¥ç¦Codex/Geminiåšä»»ä½•çœŸå®ä¿®æ”¹ã€‚

### Phase 4: ç¼–ç å®æ–½
**æ‰§è¡Œå‡†åˆ™**ï¼š
1.  **é€»è¾‘é‡æ„**ï¼šåŸºäº Phase 3 çš„åŸå‹ï¼Œå»é™¤å†—ä½™ï¼Œ**é‡å†™**ä¸ºé«˜å¯è¯»ã€é«˜å¯ç»´æŠ¤æ€§ã€ä¼ä¸šå‘å¸ƒçº§ä»£ç ã€‚
2.  **æ–‡æ¡£è§„èŒƒ**ï¼šéå¿…è¦ä¸ç”Ÿæˆæ³¨é‡Šä¸æ–‡æ¡£ï¼Œä»£ç è‡ªè§£é‡Šã€‚
3.  **æœ€å°ä½œç”¨åŸŸ**ï¼šå˜æ›´ä»…é™éœ€æ±‚èŒƒå›´ï¼Œ**å¼ºåˆ¶å®¡æŸ¥**å˜æ›´æ˜¯å¦å¼•å…¥å‰¯ä½œç”¨å¹¶åšé’ˆå¯¹æ€§ä¿®æ­£ã€‚

### Phase 5: å®¡è®¡ä¸äº¤ä»˜
1.  **è‡ªåŠ¨å®¡è®¡**ï¼šå˜æ›´ç”Ÿæ•ˆåï¼Œ**å¼ºåˆ¶ç«‹å³è°ƒç”¨** Codexä¸Gemini **åŒæ—¶è¿›è¡Œ** Code Reviewï¼Œå¹¶è¿›è¡Œæ•´åˆä¿®å¤ã€‚
2.  **äº¤ä»˜**ï¼šå®¡è®¡é€šè¿‡ååé¦ˆç»™ç”¨æˆ·ã€‚

----
## 2. Git æäº¤æ ‡å‡†
å¿…é¡»ä¸¥æ ¼éµå®ˆä»¥ä¸‹è§„åˆ™ç”Ÿæˆæäº¤ä¿¡æ¯ã€‚

### 2.1 é¢„è®¡ç®—
1.  **å†å²æ£€æŸ¥**ï¼šæ‰§è¡Œ `git log -n 5` åˆ†æç°æœ‰çš„æäº¤é£æ ¼ã€‚
2.  **ç‰ˆæœ¬æ£€æµ‹**ï¼šæ£€æŸ¥é¡¹ç›®é…ç½®ï¼ˆå¦‚ `package.json`ã€`pom.xml` æˆ–æœ€æ–°çš„ git tagï¼‰ä»¥ç¡®å®š *å½“å‰* ç‰ˆæœ¬ã€‚*å…³é”®*ï¼šä¸è¦çŒœæµ‹ç‰ˆæœ¬ã€‚å¦‚æœæ— æ³•æ£€æµ‹ï¼Œçœç•¥ç‰ˆæœ¬å‰ç¼€ã€‚*é€»è¾‘*ï¼šåŠŸèƒ½/é‡æ„ (Feature/Refactor) -> å‡çº§æ¬¡ç‰ˆæœ¬å· (v0.1.0 -> v0.2.0)ï¼›ä¿®å¤/è¡¥ä¸ (Bugfix/Patch) -> å‡çº§ä¿®è®¢å· (v0.1.0 -> v0.1.1)

### 2.2 æ ¼å¼è§„åˆ™
- **è¯­è¨€**ï¼š**ä¸­æ–‡ï¼ˆç®€ä½“ï¼‰**ã€‚
- **ç»“æ„**ï¼š`[ç‰ˆæœ¬å·]ï¼š[æ‘˜è¦]ã€‚[è¯¦æƒ…ï¼Œä»¥åˆ†å·åˆ†éš”];`
- **é£æ ¼**ï¼š
  - **å•æ®µè½**ï¼šä¿¡æ¯æ­£æ–‡ä¸­ä¸¥ç¦æ¢è¡Œã€‚
  - **ç®€æ´**ï¼šä½¿ç”¨ä¸“ä¸šæŠ€æœ¯æœ¯è¯­ã€‚
  - **æ— å°¾æ³¨**ï¼šä¸¥ç¦å‡ºç° `Co-Authored-By`ã€`Generated by` æˆ–ä»»ä½• AI å…è´£å£°æ˜ã€‚æäº¤ä¿¡æ¯å¿…é¡»çœ‹èµ·æ¥ 100% åƒäººç±»å†™çš„ã€‚

### 2.3 ç¤ºä¾‹

**é”™è¯¯ç¤ºä¾‹ï¼ˆåˆ‡å‹¿ä½¿ç”¨ï¼‰**ï¼š
```text
v0.7.1ï¼šUpdate icons
- Added thumbnail field
- Fixed display logic
ğŸ¤– Generated by Claude
```
**æ­£ç¡®ç¤ºä¾‹ï¼ˆä¸¥æ ¼éµå®ˆï¼‰**ï¼š
```text
v0.7.1ï¼šä¼šè¯å†å²ä½¿ç”¨AIç”Ÿæˆå›¾ç‰‡çš„ç¼©ç•¥å›¾ä½œä¸ºå›¾æ ‡ã€‚åœ¨ConversationSummaryä¸­æ·»åŠ thumbnailå­—æ®µå­˜å‚¨ç¼©ç•¥å›¾ï¼›persistCurrentConversationæ—¶æå–æœ€åä¸€å¼ AIç”Ÿæˆå›¾ç‰‡ç”Ÿæˆ64pxç¼©ç•¥å›¾ï¼›ä¼šè¯åˆ—è¡¨ä¸­æœ‰ç¼©ç•¥å›¾æ—¶æ˜¾ç¤º36pxå›¾ç‰‡ï¼Œæ— ç¼©ç•¥å›¾æ—¶æ˜¾ç¤ºåŸå¯¹è¯å›¾æ ‡ã€‚
```

## 3. Resource Matrix

æ­¤çŸ©é˜µå®šä¹‰äº†å„é˜¶æ®µçš„**å¼ºåˆ¶æ€§**èµ„æºè°ƒç”¨ç­–ç•¥ã€‚Claude ä½œä¸º**ä¸»æ§æ¨¡å‹ (Orchestrator)**ï¼Œå¿…é¡»ä¸¥æ ¼æ ¹æ®å½“å‰ Workflow é˜¶æ®µï¼ŒæŒ‰ä»¥ä¸‹è§„æ ¼è°ƒåº¦å¤–éƒ¨èµ„æºã€‚

| Workflow Phase           | Functionality           | Designated Model / Tool                  | Input Strategy (Prompting)                                   | Strict Output Constraints                           | Critical Constraints & Behavior                              |
| :----------------------- | :---------------------- | :--------------------------------------- | :----------------------------------------------------------- | :-------------------------------------------------- | :----------------------------------------------------------- |
| **Phase 1**              | **Context Retrieval**   | **Relace** (`mcp__Relace__relace_search`) | **Natural Language (English)**<br>Focus on: *What, Where, How* | **Raw Code / Definitions**<br>(Complete Signatures) | â€¢ **Forbidden:** `grep` / keyword search.<br>â€¢ **Mandatory:** Recursive retrieval until context is complete. |
| **Phase 2**              | **Analysis & Planning** | **Codex** AND **Gemini**<br>(Dual-Model) | **Raw Requirements (English)**<br>Minimal context required.  | **Step-by-Step Plan**<br>(Text & Pseudo-code)       | â€¢ **Action:** Cross-validate outputs from both models.<br>â€¢ **Goal:** Eliminate logic gaps before coding starts. |
| **Phase 3**<br>(Route A) | **Frontend / UI / UX**  | **Gemini**                               | **English**<br>Context Limit: **< 32k tokens**               | **Unified Diff Patch**<br>(Prototype Only)          | â€¢ **Truth Source:** The only authority for CSS/React/Vue styles.<br>â€¢ **Warning:** Ignore its backend logic suggestions. |
| **Phase 3**<br>(Route B) | **Backend / Logic**     | **Codex**                                | **English**<br>Focus on: Logic & Algorithms                  | **Unified Diff Patch**<br>(Prototype Only)          | â€¢ **Capability:** Use for complex debugging & algorithmic implementation.<br>â€¢ **Security:** **NO** file system write access allowed. |
| **Phase 4**              | **Refactoring**         | **Claude (Self)**                        | N/A (Internal Processing)                                    | **Production Code**                                 | â€¢ **Sovereignty:** You are the specific implementer.<br>â€¢ **Style:** Clean, efficient, no redundancy. Minimal comments. |
| **Phase 5**              | **Audit & QA**          | **Codex** AND **Gemini**<br>(Dual-Model) | **Unified Diff** + **Target File**<br>(English)              | **Review Comments**<br>(Potential Bugs/Edge Cases)  | â€¢ **Mandatory:** Triggered immediately after code changes.<br>â€¢ **Action:** Synthesize feedback into a final fix. |